# Official language image. Look for the different tagged releases at:
# https://hub.docker.com/r/library/python/tags/
image: python:latest
stages:
  - test
  - run

before_script:
  - python --version  # For debugging
  - pip install markdown
  
test:
  script:
    - python -m py_compile *.py

run:
  script:
    - python spotify-backup.py --format=json --dump=liked --redirect-url=$SPOTIFY_REDIRECT_URL output.json
    - python spotify-backup.py --format=md --dump=liked --redirect-url=$SPOTIFY_REDIRECT_URL output.md
    - python -m markdown output.md -x extra -f output.html
  artifacts:
    paths:
      - output.json
      - output.md
      - output.html
  # trigger this job only "by-hand"
  when: manual

#pages:
#  script:
#    - mkdir public
#  artifacts:
#    paths:
#      - public
#  rules:
#    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
